name: 🧱 Build Release
on:
  release:
    types: [published]

# Add the LICENSE file to the release files
jobs:
  release:
    name: Upload Release Asset
    runs-on: ubuntu-latest # linux required if you want to use docker
    container:
      image: walkero/docker4amigavbcc:latest-m68k
      volumes:
        - '${{ github.workspace }}:/opt/code'
    steps:
      - name: 🚚 Get latest code
        uses: actions/checkout@v2
      - name: 🏃 Running Make
        run: make
      - name: ➡️ Move to build folder
        run: cp Mnemosyne /opt/code/build/
      - name: 📁 Create Release folder
        run: |
          mkdir /opt/code/Release/
          cp -a /opt/code/build/. /opt/code/Release/Mnemosyne-${{ github.event.release.tag_name }}
          cp /opt/code/images/drawer_3.0.info /opt/code/Release/Mnemosyne-${{ github.event.release.tag_name }}.info
          cd /opt/code/Release/
      - name: 📦 Create LHA archive
        run: lha -aq2o6 Mnemosyne.lha Mnemosyne-${{ github.event.release.tag_name }}/ Mnemosyne-${{ github.event.release.tag_name }}.info
      - name: 🚀Upload Release Asset
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ github.event.release.upload_url }}
          asset_path: ./Release/Mnemosyne.lha
          asset_name: Mnemosyne.lha
          asset_content_type: application/x-lzh-compressed

